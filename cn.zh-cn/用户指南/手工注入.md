# 手工注入<a name="cpts_01_0065"></a>

## 前提条件<a name="section7566133241213"></a>

服务已经在混合集群部署，并且服务可以正常访问。

>![](public_sys-resources/icon-notice.gif) **须知：**   
>故障注入后可能会导致服务不可用，请故障注入前提前确认服务是否有用户在使用。  

## 操作步骤<a name="section672414316220"></a>

1.  登录CPTS控制台，在左侧导航栏中选择“混沌工程“。
2.  单击“手工注入 \> 故障注入”，配置以下参数。

    **表 1**  参数说明

    <a name="table32211522155718"></a>
    <table><thead align="left"><tr id="row4221152220575"><th class="cellrowborder" valign="top" width="19.12%" id="mcps1.2.3.1.1"><p id="p1221102210575"><a name="p1221102210575"></a><a name="p1221102210575"></a>参数</p>
    </th>
    <th class="cellrowborder" valign="top" width="80.88%" id="mcps1.2.3.1.2"><p id="p322282255713"><a name="p322282255713"></a><a name="p322282255713"></a>说明</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row1222102212577"><td class="cellrowborder" valign="top" width="19.12%" headers="mcps1.2.3.1.1 "><p id="p20222122135714"><a name="p20222122135714"></a><a name="p20222122135714"></a>选择环境类型</p>
    </td>
    <td class="cellrowborder" valign="top" width="80.88%" headers="mcps1.2.3.1.2 "><p id="p1722213228578"><a name="p1722213228578"></a><a name="p1722213228578"></a>目前只支持对CCE集群做故障注入。</p>
    </td>
    </tr>
    <tr id="row155504517583"><td class="cellrowborder" valign="top" width="19.12%" headers="mcps1.2.3.1.1 "><p id="p25511853583"><a name="p25511853583"></a><a name="p25511853583"></a>选择集群</p>
    </td>
    <td class="cellrowborder" valign="top" width="80.88%" headers="mcps1.2.3.1.2 "><p id="p05512520586"><a name="p05512520586"></a><a name="p05512520586"></a>选择需要注入故障的集群。</p>
    </td>
    </tr>
    <tr id="row7311728135812"><td class="cellrowborder" valign="top" width="19.12%" headers="mcps1.2.3.1.1 "><p id="p931162811586"><a name="p931162811586"></a><a name="p931162811586"></a>选择命名空间</p>
    </td>
    <td class="cellrowborder" valign="top" width="80.88%" headers="mcps1.2.3.1.2 "><p id="p1331122875810"><a name="p1331122875810"></a><a name="p1331122875810"></a>选择对应的命名空间。</p>
    </td>
    </tr>
    <tr id="row1871013814586"><td class="cellrowborder" valign="top" width="19.12%" headers="mcps1.2.3.1.1 "><p id="p1371073816585"><a name="p1371073816585"></a><a name="p1371073816585"></a>选择服务</p>
    </td>
    <td class="cellrowborder" valign="top" width="80.88%" headers="mcps1.2.3.1.2 "><p id="p27115387585"><a name="p27115387585"></a><a name="p27115387585"></a>选择对应的服务，若无可选的服务，参照<a href="https://support.huaweicloud.com/usermanual-cce/cce_01_0010.html" target="_blank" rel="noopener noreferrer">网络概述</a>创建。</p>
    </td>
    </tr>
    <tr id="row59601946135818"><td class="cellrowborder" valign="top" width="19.12%" headers="mcps1.2.3.1.1 "><p id="p15222105575813"><a name="p15222105575813"></a><a name="p15222105575813"></a>选择实例</p>
    </td>
    <td class="cellrowborder" valign="top" width="80.88%" headers="mcps1.2.3.1.2 "><p id="p13960154619587"><a name="p13960154619587"></a><a name="p13960154619587"></a>选择对应的实例，若无可选的实例，参照<a href="https://support.huaweicloud.com/usermanual-cce/cce_01_0047.html" target="_blank" rel="noopener noreferrer">创建工作负载</a>创建。</p>
    </td>
    </tr>
    <tr id="row139822395915"><td class="cellrowborder" valign="top" width="19.12%" headers="mcps1.2.3.1.1 "><p id="p149821315597"><a name="p149821315597"></a><a name="p149821315597"></a>故障设置</p>
    </td>
    <td class="cellrowborder" valign="top" width="80.88%" headers="mcps1.2.3.1.2 "><p id="p99572191510"><a name="p99572191510"></a><a name="p99572191510"></a>选择故障模式</p>
    <a name="ul169679191015"></a><a name="ul169679191015"></a><ul id="ul169679191015"><li>容器实例<a name="ul10966019016"></a><a name="ul10966019016"></a><ul id="ul10966019016"><li>杀容器实例</li></ul>
    </li><li>CPU<a name="ul29661619418"></a><a name="ul29661619418"></a><ul id="ul29661619418"><li>CPU过载：系统CPU使用率达到用户指定目标使用率。</li></ul>
    </li><li>内存<a name="ul119671919915"></a><a name="ul119671919915"></a><ul id="ul119671919915"><li>内存过载：系统内存使用率达到用户指定目标使用率。</li></ul>
    </li><li>进程<a name="ul096713191918"></a><a name="ul096713191918"></a><ul id="ul096713191918"><li>杀进程：进程异常退出。</li><li>挂起进程：使指定进程处于挂起状态。</li></ul>
    </li><li>网络<a name="ul9813162810310"></a><a name="ul9813162810310"></a><ul id="ul9813162810310"><li>网络报文延迟：对报文按比例进行延迟。</li><li>网络报文丢失：对报文按比例进行丢弃。</li><li>网络报文错误：对报文按比例进行修改。</li><li>网络报文重复：对报文按比例进行重复。</li><li>网络报文乱序：对报文按比例进行乱序。</li><li>网络报文多重损伤：对报文进行延迟、丢弃、错误、重复、乱序等多重损伤。</li><li>TCP连接吊死（建立连接时）：对建立TCP连接的请求进行丢包。</li><li>TCP连接吊死（释放连接时）：对释放TCP连接的请求进行丢包。</li><li>TCP连接重置：对TCP请求进行重置拒绝。</li><li>网络单通：丢弃服务端给客户端的响应报文。</li><li>网络报文限速：指定的连接被限制传输速率。</li></ul>
    </li><li>磁盘<a name="ul930519121617"></a><a name="ul930519121617"></a><ul id="ul930519121617"><li>磁盘满：指定的磁盘的使用率达到用户指定的目标使用率。</li><li>磁盘IO高：磁盘读写繁忙。</li></ul>
    </li></ul>
    </td>
    </tr>
    <tr id="row1811652614216"><td class="cellrowborder" valign="top" width="19.12%" headers="mcps1.2.3.1.1 "><p id="p19808153611216"><a name="p19808153611216"></a><a name="p19808153611216"></a>故障持续时长</p>
    </td>
    <td class="cellrowborder" valign="top" width="80.88%" headers="mcps1.2.3.1.2 "><a name="ul1891910172245"></a><a name="ul1891910172245"></a><ul id="ul1891910172245"><li>关闭故障持续时长，故障注入后，故障会一直存在，需要在手工注入页面对故障记录执行“清除故障”，才可以将该故障清除。</li><li>开启故障持续时长，可以设置在故障注入[1, 3600]秒后，由系统自动清除该故障。</li></ul>
    </td>
    </tr>
    <tr id="row1721913392611"><td class="cellrowborder" valign="top" width="19.12%" headers="mcps1.2.3.1.1 "><p id="p19219103314262"><a name="p19219103314262"></a><a name="p19219103314262"></a>设置服务监控告警（建议）</p>
    </td>
    <td class="cellrowborder" valign="top" width="80.88%" headers="mcps1.2.3.1.2 "><p id="p1321919331265"><a name="p1321919331265"></a><a name="p1321919331265"></a>点击“设置”后，将打开应用运维管理（AOM）服务页面，您可以在应用运维管理的“告警中心 &gt; 阈值规则”页面自定义服务阈值规则，通过阈值规则可对测试服务资源的指标设置阈值条件，当指标数据满足阈值条件时，会产生阈值告警，辅助对测试过程进行监控。具体操作请参见<a href="https://support.huaweicloud.com/usermanual-aom/aom_02_00100.html" target="_blank" rel="noopener noreferrer">创建阈值规则</a>。</p>
    </td>
    </tr>
    <tr id="row7708151012286"><td class="cellrowborder" valign="top" width="19.12%" headers="mcps1.2.3.1.1 "><p id="p157081410132810"><a name="p157081410132810"></a><a name="p157081410132810"></a>服务状态探测</p>
    </td>
    <td class="cellrowborder" valign="top" width="80.88%" headers="mcps1.2.3.1.2 "><p id="p1708111015286"><a name="p1708111015286"></a><a name="p1708111015286"></a>开启服务状态探测后，探针通过发送HTTP请求到服务，对服务是否可以连通进行校验。</p>
    </td>
    </tr>
    <tr id="row51191313305"><td class="cellrowborder" valign="top" width="19.12%" headers="mcps1.2.3.1.1 "><p id="p41131314309"><a name="p41131314309"></a><a name="p41131314309"></a>选择CPTS测试任务（可选）</p>
    </td>
    <td class="cellrowborder" valign="top" width="80.88%" headers="mcps1.2.3.1.2 "><p id="p282164717317"><a name="p282164717317"></a><a name="p282164717317"></a>通过选择CPTS测试任务，在进行故障注入的同时，进行业务性能压测，辅助可靠性测试。</p>
    <p id="p149049119336"><a name="p149049119336"></a><a name="p149049119336"></a>若无可选的CPTS测试任务，单击“新建工程”，参照<a href="创建测试工程.md">创建测试工程</a>创建。</p>
    <div class="note" id="note1957510188329"><a name="note1957510188329"></a><a name="note1957510188329"></a><span class="notetitle"> 说明： </span><div class="notebody"><p id="p4119135303"><a name="p4119135303"></a><a name="p4119135303"></a>如果选择CPTS测试任务，则需要在CPTS任务页面先启动测试任务，再注入故障。</p>
    </div></div>
    </td>
    </tr>
    </tbody>
    </table>

3.  配置完成，单击“注入故障”，注入故障后会提示“注入故障成功”，您可以选择“继续注入”或“返回故障列表”。
4.  您还可以进行“清除故障”、“重新注入”和“删除”的操作。
    -   清除故障：在故障列表页面，单击待操作故障模式后的“清除故障”。
    -   重新注入：在故障列表页面，单击待操作故障模式后的“重新注入”。
    -   删除：在故障列表页面，单击待操作故障模式后的“删除”，在弹出的对话框中根据提示输入“DELETE”，单击确定。

        >![](public_sys-resources/icon-notice.gif) **须知：**   
        >故障删除后，对应的测试报告等可能也会被删除，请删除前先确认测试报告已经下载。  



