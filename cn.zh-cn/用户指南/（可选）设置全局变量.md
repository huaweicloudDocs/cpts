# （可选）设置全局变量<a name="cpts_01_0033"></a>

全局变量用于构造数据集合，使测试数据更加丰富。在报文事务元素的报文内容中引用全局变量，执行压测任务过程会将报文内容中的变量值动态替换为指定的值。

全局变量可以用于很多场景，例如需要用户名密码的业务中，需要使用不同的用户名以及对应密码模拟多用户场景进行压测。

>![](public_sys-resources/icon-note.gif) **说明：**   
>新增全局变量，并在压测任务的报文中使用时，若执行此压测任务的资源组未升级到最新版本，全局变量功能将不可用。资源组升级请参见[升级资源组](升级资源组.md)。  

## 设置全局变量<a name="section177089374215"></a>

1.  登录CPTS控制台。
2.  选择左侧导航栏的“测试工程“，单击待编辑测试工程后的“编辑事务模型“。
3.  在“事务模型”页签下，单击“全局变量”。

    **图 1**  添加全局变量<a name="fig1934011374015"></a>  
    ![](figures/添加全局变量.png "添加全局变量")

    >![](public_sys-resources/icon-note.gif) **说明：**   
    >每个测试工程下的全局变量，仅当前工程可用。  

4.  <a name="li1382885820223"></a>单击“添加变量”，参照[表1](#table9822191913365)设置基本信息，其中带“\*”标志的参数为必填参数。

    **图 2**  设置全局变量参数<a name="fig62613717412"></a>  
    ![](figures/设置全局变量参数.png "设置全局变量参数")

    **表 1**  设置全局变量

    <a name="table9822191913365"></a>
    <table><thead align="left"><tr id="row1821131923616"><th class="cellrowborder" valign="top" width="23%" id="mcps1.2.3.1.1"><p id="p3821181943619"><a name="p3821181943619"></a><a name="p3821181943619"></a>参数</p>
    </th>
    <th class="cellrowborder" valign="top" width="77%" id="mcps1.2.3.1.2"><p id="p1982151914363"><a name="p1982151914363"></a><a name="p1982151914363"></a>参数说明</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row15821121953612"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p382161914363"><a name="p382161914363"></a><a name="p382161914363"></a>*变量名称</p>
    </td>
    <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><p id="p18821101943613"><a name="p18821101943613"></a><a name="p18821101943613"></a>全局变量的名称。</p>
    </td>
    </tr>
    <tr id="row11821181943618"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p4821119183617"><a name="p4821119183617"></a><a name="p4821119183617"></a>*变量类型</p>
    </td>
    <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><p id="p282161919368"><a name="p282161919368"></a><a name="p282161919368"></a>支持整数和枚举。</p>
    </td>
    </tr>
    <tr id="row1182261933613"><td class="cellrowborder" rowspan="2" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p1182221911361"><a name="p1182221911361"></a><a name="p1182221911361"></a>*变量值</p>
    <div class="note" id="note773144123716"><a name="note773144123716"></a><a name="note773144123716"></a><span class="notetitle"> 说明： </span><div class="notebody"><p id="p374184443716"><a name="p374184443716"></a><a name="p374184443716"></a>变量的内容，在压测时将以明文传输，请谨慎输入，注意数据安全。</p>
    </div></div>
    </td>
    <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><p id="p78221319193612"><a name="p78221319193612"></a><a name="p78221319193612"></a>变量类型为整数时，输入变量值范围。</p>
    <p id="p082241933619"><a name="p082241933619"></a><a name="p082241933619"></a>压测任务运行时会读取对应全局变量范围内的值，针对每个虚拟用户，依次轮询变量值，即第一个虚拟用户取变量的第一个值，第二个虚拟用户取第二个值，依顺序取值，不够则循环。</p>
    </td>
    </tr>
    <tr id="row982211191364"><td class="cellrowborder" valign="top" headers="mcps1.2.3.1.1 "><p id="p1482214195362"><a name="p1482214195362"></a><a name="p1482214195362"></a>变量类型为枚举时，执行以下步骤。</p>
    <a name="ol1582201993619"></a><a name="ol1582201993619"></a><ol id="ol1582201993619"><li>单击<a name="image18601354124213"></a><a name="image18601354124213"></a><span><img id="image18601354124213" src="figures/添加.png"></span>。</li><li>输入变量值。</li><li>（可选）您可以根据业务需求添加多个变量值。</li></ol>
    <p id="p1782219194365"><a name="p1782219194365"></a><a name="p1782219194365"></a>压测任务运行时会读取对应全局变量的参数值，针对每个虚拟用户，依次轮询变量值，即第一个虚拟用户取变量的第一个值，第二个虚拟用户取第二个值，依顺序取值，不够则循环。</p>
    </td>
    </tr>
    </tbody>
    </table>

5.  <a name="li154570223331"></a>设置完后单击![](figures/保存.png)。
6.  （可选）您可以参考[4](#li1382885820223)~[5](#li154570223331)添加多个全局变量。
7.  单击![](figures/关闭.png)。

## 修改全局变量<a name="section3828162214231"></a>

1.  登录CPTS控制台。
2.  选择左侧导航栏的“测试工程“，单击待编辑测试工程后的“编辑事务模型“。
3.  在“事务模型”页签下，单击“全局变量”。

    **图 3**  事务模型-全局变量<a name="fig6220174374616"></a>  
    ![](figures/事务模型-全局变量.png "事务模型-全局变量")

4.  单击待修改的全局变量后的“编辑”，参照[表1](#table9822191913365)修改**变量类型**和**变量值**。

    单击待修改的全局变量后的“下载”，可以下载该全局变量。

    **图 4**  修改全局变量<a name="fig139325302474"></a>  
    ![](figures/修改全局变量.png "修改全局变量")

    >![](public_sys-resources/icon-note.gif) **说明：**   
    >若该全局变量被事务所引用，则修改后，事务中的全局变量值同步修改。  

5.  修改完后单击![](figures/保存.png)。

## 导入全局变量文件<a name="section184321425121911"></a>

通过文件的方式导入全局变量。

1.  登录CPTS控制台。
2.  选择左侧导航栏的“测试工程“，单击待编辑测试工程后的“编辑事务模型“。
3.  在“事务模型”页签下，单击“全局变量”。

    **图 5**  添加全局变量<a name="fig1567652655111"></a>  
    ![](figures/添加全局变量.png "添加全局变量")

4.  单击“本地导入”上传文件，支持上传xlsx、csv格式的文件。

    >![](public_sys-resources/icon-note.gif) **说明：**   
    >页面上提供了xlsx、csv模板的下载。您可以根据需要，下载对应模板，然后按照模板格式进行编辑，编辑完成后再导入。  

    **图 6**  本地导入<a name="fig3513910115215"></a>  
    ![](figures/本地导入.png "本地导入")

5.  上传成功后，导入的全局变量文件会在页面显示如下。

    其中：

    -   变量名称为导入的文件名称。
    -   变量值为实际的变量名称，多个变量名称之间以“,”分隔。

    **图 7**  查看导入的全局变量<a name="fig1913115695316"></a>  
    ![](figures/查看导入的全局变量.png "查看导入的全局变量")

    >![](public_sys-resources/icon-note.gif) **说明：**   
    >-   全局变量文件导入完成后，您还可以“再次导入”新的全局变量文件。  
    >-   对于已经导入的全局变量文件，如果您本地做了修改，还可以“重新上传”。  
    >-   若您不再使用导入的全局变量文件，可以单击“删除”按钮，删除导入的全局变量文件。  

6.  单击事务的![](figures/编辑.png)按钮，在“编辑元素”页面的“请求链接”下，输入**$**符号，可以选择导入的变量名称。

    **图 8**  编辑报文<a name="fig13822476551"></a>  
    ![](figures/编辑报文.png "编辑报文")


