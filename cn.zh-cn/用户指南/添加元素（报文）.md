# 添加元素（报文）<a name="cpts_01_0013"></a>

报文是HTTP/HTTPS/TCP/UDP应用程序之间发送的数据块。这些数据块以一些文本形式的元信息开头，这些信息描述了报文的内容及含义，后面跟着可选的数据部分。这些报文都是在客户端、服务器和代理之间流动。

## 操作步骤<a name="section136429403367"></a>

1.  登录CPTS控制台，在左侧导航栏中选择“测试工程“。单击待编辑事务模型工程后的“编辑事务模型“。
2.  在“事务模型“页签中，单击待添加元素事务下的![](figures/icon-addelement-1.png)。
3.  元素类型设置为“报文“。参照[表1](#table178291225164211)设置基本信息，其中带“\*”标志的参数为必填参数。

    **图 1**  元素类型为报文<a name="fig75871932113010"></a>  
    ![](figures/元素类型为报文.png "元素类型为报文")

    **表 1**  元素类型为报文

    <a name="table178291225164211"></a>
    <table><thead align="left"><tr id="row108261025124213"><th class="cellrowborder" valign="top" width="32%" id="mcps1.2.3.1.1"><p id="p10826122513421"><a name="p10826122513421"></a><a name="p10826122513421"></a>参数</p>
    </th>
    <th class="cellrowborder" valign="top" width="68%" id="mcps1.2.3.1.2"><p id="p3826025154215"><a name="p3826025154215"></a><a name="p3826025154215"></a>参数说明</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row682611256424"><td class="cellrowborder" valign="top" width="32%" headers="mcps1.2.3.1.1 "><p id="p182642534215"><a name="p182642534215"></a><a name="p182642534215"></a>协议类型</p>
    </td>
    <td class="cellrowborder" valign="top" width="68%" headers="mcps1.2.3.1.2 "><p id="p68261625204212"><a name="p68261625204212"></a><a name="p68261625204212"></a>请根据业务的协议类型选择。</p>
    </td>
    </tr>
    <tr id="row68261425174218"><td class="cellrowborder" colspan="2" valign="top" headers="mcps1.2.3.1.1 mcps1.2.3.1.2 "><p id="p38261225124211"><a name="p38261225124211"></a><a name="p38261225124211"></a>当请求类型为HTTP和HTTPS时，设置以下参数。</p>
    </td>
    </tr>
    <tr id="row20473194816538"><td class="cellrowborder" valign="top" width="32%" headers="mcps1.2.3.1.1 "><p id="p1247419488537"><a name="p1247419488537"></a><a name="p1247419488537"></a>HTTP版本</p>
    </td>
    <td class="cellrowborder" valign="top" width="68%" headers="mcps1.2.3.1.2 "><p id="p11474148145319"><a name="p11474148145319"></a><a name="p11474148145319"></a>无需配置，默认为HTTP1.1版本。</p>
    </td>
    </tr>
    <tr id="row12827122511422"><td class="cellrowborder" valign="top" width="32%" headers="mcps1.2.3.1.1 "><p id="p10826125164210"><a name="p10826125164210"></a><a name="p10826125164210"></a><span class="keyword" id="keyword1854873514310"><a name="keyword1854873514310"></a><a name="keyword1854873514310"></a>请求方式</span></p>
    </td>
    <td class="cellrowborder" valign="top" width="68%" headers="mcps1.2.3.1.2 "><a name="ul19827725194214"></a><a name="ul19827725194214"></a><ul id="ul19827725194214"><li>GET：最常见的一种请求方式，当客户端要从服务器中读取文档时，当点击网页上的链接或者通过在浏览器的地址栏输入网址来浏览网页的，使用的都是GET方式。GET方法要求服务器将URL定位的资源放在响应报文的数据部分，回送给客户端。使用GET方法时，请求参数和对应的值附加在URL后面，利用一个问号（“?”）代表URL的结尾与请求参数的开始，传递参数长度受限制。GET类型不适合传送私密数据，也不适合需要传送大量数据的场景。</li><li>POST：对于不适合GET类型的场景，可考虑POST。POST方法可以允许客户端给服务器提供信息较多。POST方法将请求参数封装在HTTP请求数据中，以名称/值的形式出现，可以传输大量数据，这样POST方式对传送的数据大小没有限制，而且也不会显示在URL中。</li><li>PATCH：是对PUT方法的补充，用来对服务器已有资源进行局部更新。</li><li>PUT：将来自客户端的数据存储到一个命名的服务器资源中去。</li><li>DELETE：从服务器中删除命名资源。</li></ul>
    </td>
    </tr>
    <tr id="row48058504405"><td class="cellrowborder" valign="top" width="32%" headers="mcps1.2.3.1.1 "><p id="p080615016408"><a name="p080615016408"></a><a name="p080615016408"></a>响应超时(ms)</p>
    </td>
    <td class="cellrowborder" valign="top" width="68%" headers="mcps1.2.3.1.2 "><p id="p12878124634817"><a name="p12878124634817"></a><a name="p12878124634817"></a>发送请求，等待服务器响应的超时时间。</p>
    <p id="p6806185004016"><a name="p6806185004016"></a><a name="p6806185004016"></a>若不设置此参数，默认响应超时时间为5000ms。</p>
    </td>
    </tr>
    <tr id="row1182782517423"><td class="cellrowborder" valign="top" width="32%" headers="mcps1.2.3.1.1 "><p id="p1182722584211"><a name="p1182722584211"></a><a name="p1182722584211"></a>* 请求链接</p>
    </td>
    <td class="cellrowborder" valign="top" width="68%" headers="mcps1.2.3.1.2 "><p id="p88274255427"><a name="p88274255427"></a><a name="p88274255427"></a>发送请求的URL地址，比如“http://域名/路径”，也可以包含参数的部分“http://域名/路径?key1=value1&amp;key2=value2”。</p>
    </td>
    </tr>
    <tr id="row1382792510421"><td class="cellrowborder" valign="top" width="32%" headers="mcps1.2.3.1.1 "><p id="p138272025174216"><a name="p138272025174216"></a><a name="p138272025174216"></a>报文头域</p>
    </td>
    <td class="cellrowborder" valign="top" width="68%" headers="mcps1.2.3.1.2 "><p id="p8827202594210"><a name="p8827202594210"></a><a name="p8827202594210"></a>请根据压测服务器需要校验或者使用的头域来添加相关头域及内容。CPTS服务没有对必填头域作要求，仅透传用户定义的头域到压测服务器。“头域”的说明请参见<a href="头域说明.md">头域说明</a>。</p>
    <p id="p138271525184211"><a name="p138271525184211"></a><a name="p138271525184211"></a>单击<a name="image043310285331"></a><a name="image043310285331"></a><span><img id="image043310285331" src="figures/icon-add-header-field.png"></span>，设置“头域”和“值”，若您不需要添加头域信息，可以单击“删除”按钮删除报文头域。</p>
    <div class="note" id="note10827102517429"><a name="note10827102517429"></a><a name="note10827102517429"></a><span class="notetitle"> 说明： </span><div class="notebody"><p id="p11481356376"><a name="p11481356376"></a><a name="p11481356376"></a>请求方式为POST或PUT，且“头域”为“<span id="ph1947618548353"><a name="ph1947618548353"></a><a name="ph1947618548353"></a>Content-Type</span>”时，“值”有三种类型：</p>
    <a name="ul16234350419"></a><a name="ul16234350419"></a><ul id="ul16234350419"><li>自定义：直接在输入框中输入值。</li><li>application/x-www-form-urlencoded：请求体为可添加的键值对形式，值为文本。</li><li>multipart/form-data：请求体为可添加的键值对形式，值可为文本或文件。</li></ul>
    </div></div>
    </td>
    </tr>
    <tr id="row19828142584211"><td class="cellrowborder" valign="top" width="32%" headers="mcps1.2.3.1.1 "><p id="p182752524219"><a name="p182752524219"></a><a name="p182752524219"></a><span class="keyword" id="keyword1362335118450"><a name="keyword1362335118450"></a><a name="keyword1362335118450"></a>报文内容</span></p>
    </td>
    <td class="cellrowborder" valign="top" width="68%" headers="mcps1.2.3.1.2 "><p id="p1482717250428"><a name="p1482717250428"></a><a name="p1482717250428"></a>实体的主体部分包含一个由任意数据组成的数据块，并不是所有的报文都包含实体的主体部分，有时，报文只是以一个CRLF结束。</p>
    <p id="p38276253429"><a name="p38276253429"></a><a name="p38276253429"></a>如果已设置全局变量或响应提取的局部变量，可在报文内容部分引用变量，执行压测任务过程会将报文内容中的变量值动态替换为指定的值。</p>
    <a name="ol7827102534219"></a><a name="ol7827102534219"></a><ol id="ol7827102534219"><li>在报文内容输入框内输入“$”。</li><li>在“插入变量”对话框中，设置对应的“变量名称”和“变量范围”。</li><li>单击“选择”。</li></ol>
    <div class="note" id="note12828182514211"><a name="note12828182514211"></a><a name="note12828182514211"></a><span class="notetitle"> 说明： </span><div class="notebody"><p id="p782732524216"><a name="p782732524216"></a><a name="p782732524216"></a>请求方式为GET时，不支持报文内容。</p>
    </div></div>
    </td>
    </tr>
    <tr id="row78281525144218"><td class="cellrowborder" colspan="2" valign="top" headers="mcps1.2.3.1.1 mcps1.2.3.1.2 "><p id="p19828142554218"><a name="p19828142554218"></a><a name="p19828142554218"></a>当请求类型为TCP时，设置以下参数。</p>
    </td>
    </tr>
    <tr id="row08281025114210"><td class="cellrowborder" valign="top" width="32%" headers="mcps1.2.3.1.1 "><p id="p188281251423"><a name="p188281251423"></a><a name="p188281251423"></a>* IP</p>
    </td>
    <td class="cellrowborder" valign="top" width="68%" headers="mcps1.2.3.1.2 "><p id="p14828112518423"><a name="p14828112518423"></a><a name="p14828112518423"></a>发送请求到被测服务器的IP地址。</p>
    </td>
    </tr>
    <tr id="row15828102504217"><td class="cellrowborder" valign="top" width="32%" headers="mcps1.2.3.1.1 "><p id="p2828925114210"><a name="p2828925114210"></a><a name="p2828925114210"></a>* 端口号</p>
    </td>
    <td class="cellrowborder" valign="top" width="68%" headers="mcps1.2.3.1.2 "><p id="p1982817254421"><a name="p1982817254421"></a><a name="p1982817254421"></a>发送请求到被测服务器的端口号。</p>
    </td>
    </tr>
    <tr id="row982815259422"><td class="cellrowborder" valign="top" width="32%" headers="mcps1.2.3.1.1 "><p id="p17828172510425"><a name="p17828172510425"></a><a name="p17828172510425"></a>* 链接超时(ms)</p>
    </td>
    <td class="cellrowborder" valign="top" width="68%" headers="mcps1.2.3.1.2 "><p id="p1182814251423"><a name="p1182814251423"></a><a name="p1182814251423"></a>发起连接，服务器无响应的超时时间。</p>
    </td>
    </tr>
    <tr id="row78281225124216"><td class="cellrowborder" valign="top" width="32%" headers="mcps1.2.3.1.1 "><p id="p1382812517425"><a name="p1382812517425"></a><a name="p1382812517425"></a>* 返回超时(ms)</p>
    </td>
    <td class="cellrowborder" valign="top" width="68%" headers="mcps1.2.3.1.2 "><p id="p13828132514210"><a name="p13828132514210"></a><a name="p13828132514210"></a>连接建立成功，等待响应返回的超时时间。</p>
    </td>
    </tr>
    <tr id="row20828192574218"><td class="cellrowborder" valign="top" width="32%" headers="mcps1.2.3.1.1 "><p id="p19828142524211"><a name="p19828142524211"></a><a name="p19828142524211"></a>连接设置</p>
    </td>
    <td class="cellrowborder" valign="top" width="68%" headers="mcps1.2.3.1.2 "><a name="ul1082872534212"></a><a name="ul1082872534212"></a><ul id="ul1082872534212"><li>重复使用连接：请求响应完成后，不断开连接，复用连接发送接收下一次请求响应。</li><li>关闭连接：每次完成请求响应完成后，断开连接，下一次重新建立连接。</li></ul>
    </td>
    </tr>
    <tr id="row9829425104212"><td class="cellrowborder" valign="top" width="32%" headers="mcps1.2.3.1.1 "><p id="p1982872510429"><a name="p1982872510429"></a><a name="p1982872510429"></a>返回结束设置</p>
    </td>
    <td class="cellrowborder" valign="top" width="68%" headers="mcps1.2.3.1.2 "><p id="p16828122544214"><a name="p16828122544214"></a><a name="p16828122544214"></a>通过返回结束设置，来判断本次请求的响应内容是否已经接收完成。</p>
    <a name="ul78286257421"></a><a name="ul78286257421"></a><ul id="ul78286257421"><li>返回数据长度：设置返回数据的长度，单位字节。当接收到此长度的响应内容时，数据接收完成。</li><li>结束符：设置返回数据的结束标记。当接收到结束符时，数据接收完成 。<div class="note" id="note1582862517421"><a name="note1582862517421"></a><a name="note1582862517421"></a><span class="notetitle"> 说明： </span><div class="notebody"><p id="p48281225164219"><a name="p48281225164219"></a><a name="p48281225164219"></a>结束符建议设置一个唯一的结束标记，若设置的结束符在响应内容中存在多个，当接收到第一个结束符时，就认为响应内容已经接收完成，这样接收的响应数据就不完整。</p>
    </div></div>
    </li></ul>
    </td>
    </tr>
    <tr id="row982982515428"><td class="cellrowborder" valign="top" width="32%" headers="mcps1.2.3.1.1 "><p id="p18291325184213"><a name="p18291325184213"></a><a name="p18291325184213"></a>报文内容</p>
    </td>
    <td class="cellrowborder" valign="top" width="68%" headers="mcps1.2.3.1.2 "><p id="p178291525184212"><a name="p178291525184212"></a><a name="p178291525184212"></a>实体的主体部分包含一个由任意数据组成的数据块，并不是所有的报文都包含实体的主体部分，有时，报文只是以一个CRLF结束。</p>
    <p id="p682932518428"><a name="p682932518428"></a><a name="p682932518428"></a>内容格式：请根据被测服务器的业务请求内容，选择“字符串”或“16进制码流”。</p>
    <p id="p18294255427"><a name="p18294255427"></a><a name="p18294255427"></a>如果已设置全局变量或响应提取的局部变量，可在报文内容部分引用变量，执行压测任务过程会将报文内容中的变量值动态替换为指定的值。</p>
    <a name="ol1982992524219"></a><a name="ol1982992524219"></a><ol id="ol1982992524219"><li>在报文内容输入框内输入“$”。</li><li>在“插入变量”对话框中，设置对应的“变量名称”和“变量范围”。</li><li>单击“选择”。</li></ol>
    </td>
    </tr>
    <tr id="row1442153264416"><td class="cellrowborder" colspan="2" valign="top" headers="mcps1.2.3.1.1 mcps1.2.3.1.2 "><p id="p194313509441"><a name="p194313509441"></a><a name="p194313509441"></a>当请求类型为UDP时，设置以下参数。</p>
    <div class="note" id="note573293613232"><a name="note573293613232"></a><a name="note573293613232"></a><span class="notetitle"> 说明： </span><div class="notebody"><p id="p1973253617236"><a name="p1973253617236"></a><a name="p1973253617236"></a>思考时间、报文、响应提取、检查点功能都支持UDP协议类型。</p>
    </div></div>
    </td>
    </tr>
    <tr id="row61201535134415"><td class="cellrowborder" valign="top" width="32%" headers="mcps1.2.3.1.1 "><p id="p11120635114413"><a name="p11120635114413"></a><a name="p11120635114413"></a>* IP</p>
    </td>
    <td class="cellrowborder" valign="top" width="68%" headers="mcps1.2.3.1.2 "><p id="p79511539469"><a name="p79511539469"></a><a name="p79511539469"></a>发送请求到被测服务器的IP地址。</p>
    </td>
    </tr>
    <tr id="row181450378449"><td class="cellrowborder" valign="top" width="32%" headers="mcps1.2.3.1.1 "><p id="p14145183710442"><a name="p14145183710442"></a><a name="p14145183710442"></a>* 端口号</p>
    </td>
    <td class="cellrowborder" valign="top" width="68%" headers="mcps1.2.3.1.2 "><p id="p17954135384610"><a name="p17954135384610"></a><a name="p17954135384610"></a>发送请求到被测服务器的端口号。</p>
    </td>
    </tr>
    <tr id="row354239204412"><td class="cellrowborder" valign="top" width="32%" headers="mcps1.2.3.1.1 "><p id="p4541839144410"><a name="p4541839144410"></a><a name="p4541839144410"></a>返回结束设置</p>
    </td>
    <td class="cellrowborder" valign="top" width="68%" headers="mcps1.2.3.1.2 "><p id="p103862436465"><a name="p103862436465"></a><a name="p103862436465"></a>通过返回结束设置，来判断本次请求的响应内容是否已经接收完成。</p>
    <a name="ul238944312461"></a><a name="ul238944312461"></a><ul id="ul238944312461"><li>返回数据长度：设置返回数据的长度，单位字节。当接收到此长度的响应内容时，数据接收完成。</li><li>结束符：设置返回数据的结束标记。当接收到结束符时，数据接收完成 。<div class="note" id="note16393143164619"><a name="note16393143164619"></a><a name="note16393143164619"></a><span class="notetitle"> 说明： </span><div class="notebody"><p id="p18395134394619"><a name="p18395134394619"></a><a name="p18395134394619"></a>结束符建议设置一个唯一的结束标记，若设置的结束符在响应内容中存在多个，当接收到第一个结束符时，就认为响应内容已经接收完成，这样接收的响应数据就不完整。</p>
    </div></div>
    </li></ul>
    </td>
    </tr>
    <tr id="row18718194214456"><td class="cellrowborder" valign="top" width="32%" headers="mcps1.2.3.1.1 "><p id="p971824215453"><a name="p971824215453"></a><a name="p971824215453"></a>报文内容</p>
    </td>
    <td class="cellrowborder" valign="top" width="68%" headers="mcps1.2.3.1.2 "><p id="p21651625174620"><a name="p21651625174620"></a><a name="p21651625174620"></a>实体的主体部分包含一个由任意数据组成的数据块，并不是所有的报文都包含实体的主体部分，有时，报文只是以一个CRLF结束。</p>
    <p id="p12165202512469"><a name="p12165202512469"></a><a name="p12165202512469"></a>内容格式：请根据被测服务器的业务请求内容，选择“字符串”或“16进制码流”。</p>
    <p id="p131670256465"><a name="p131670256465"></a><a name="p131670256465"></a>如果已设置全局变量或响应提取的局部变量，可在报文内容部分引用变量，执行压测任务过程会将报文内容中的变量值动态替换为指定的值。</p>
    <a name="ol1316782564615"></a><a name="ol1316782564615"></a><ol id="ol1316782564615"><li>在报文内容输入框内输入“$”。</li><li>在“插入变量”对话框中，设置对应的“变量名称”和“变量范围”。</li><li>单击“选择”。</li></ol>
    </td>
    </tr>
    </tbody>
    </table>

4.  配置完成后，单击“确定“。

## 报文如何填写<a name="section855748113413"></a>

报文通俗的解释就是说平时我们在网站上面的所有点击操作，都是通过编辑成，满足协议规范带有用户请求内容格式的码流传送给不同的第三方，最后得到一个正确或者失败响应的一个过程。可以通过在操作时按“F12”，或抓包工具（例如wireshark）查看报文是怎么请求的，然后根据实际业务在压测的报文中填写。

例如，模拟登录请求的POST方法，对应的请求链接、请求方法、头域、报文内容如下图所示。

**图 2**  模拟登录请求的POST方法<a name="fig6113310143412"></a>  
![](figures/模拟登录请求的POST方法.png "模拟登录请求的POST方法")

